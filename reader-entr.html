<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Welcome, reader</title>
        <link rel="stylesheet" href="style.css">
        <style>
         image-container {
             position: relative;
             display: inline-block;
         }
         .annotation {
             position: absolute;
             color: red;
             font-size: 20px;
             font-weight: bold;
             pointer-events: none;
         }
         img {
             max-width: 100%;
             height: auto;
         }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>Hello, this is the reader's page served by <tt>lighttpd</tt> running on Alpine Linux in Docker!</h1>
        </div>
        <?php
        $images = glob("uploads/*.{jpg,jpeg,png,gif}", GLOB_BRACE);
        foreach ($images as $image) {
            echo "<a href='annotate-image.php?image=" . urlencode($image) . "'>Annotate " . htmlspecialchars(basename($image)) . "</a><br>";
        }
        ?>

        <script>
            const imageContainer = document.getElementById('image-container');
            let count = 0;

            function addAnnotation(event) {
                // Calculate the position of the annotation
                const rect = event.target.getBoundingClientRect();
                const posX = event.clientX - rect.left;
                const posY = event.clientY - rect.top;

                // Create and position the annotation element
                const annotation = document.createElement('div');
                annotation.classList.add('annotation');
                annotation.style.left = `${posX}px`;
                annotation.style.top = `${posY}px`;
                annotation.innerText = ++count; // Increment the count and display as the annotation text

                // Append the annotation to the image container
                imageContainer.appendChild(annotation);

                // Prevent further event propagation
                event.preventDefault();
            }

            // Add click event listener to the image container
            document.getElementById('imageToAnnotate').addEventListener('click', addAnnotation);
        </script>
    </body>
</html>
